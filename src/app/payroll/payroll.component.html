<p>payroll works!</p>
<div class="card">
  <p-tabMenu [model]="items" [activeItem]="activeItem"></p-tabMenu>

  <div class="p-fluid grid mt-3">
    <div class="field col-12 md:col-4">
      <label>Start Period (YYYY-MM)</label>
      <p-calendar
        [(ngModel)]="startDate"
        view="month"
        dateFormat="yy-mm"
        [readonlyInput]="true"
        (onSelect)="onDateSelect()"
      ></p-calendar>
    </div>
    <div class="field col-12 md:col-4">
      <label>End Period (YYYY-MM)</label>
      <p-calendar
        [(ngModel)]="endDate"
        view="month"
        dateFormat="yy-mm"
        [readonlyInput]="true"
        (onSelect)="onDateSelect()"
      ></p-calendar>
    </div>
    <div class="field col-12 md:col-4">
      <label>&nbsp;</label>
      <button
        pButton
        type="button"
        label="Load Data"
        [disabled]="!startDate || !endDate"
        (click)="loadData()"
      ></button>
    </div>
  </div>

  <p-messages [value]="messages"></p-messages>

  <!-- Loading Indicator -->
  @if (loading) {
  <div class="flex justify-content-center">
    <p-progressSpinner></p-progressSpinner>
  </div>
  }

  <!-- Segmented View -->
  @if (!loading && activeView === 'segmented') {
  <div class="mt-3">
    <p-table
      [value]="segmentedData"
      [scrollable]="true"
      styleClass="p-datatable-gridlines"
      [tableStyle]="{ 'min-width': '50rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Employee</th>
          <th>Department</th>
          <th>Designation</th>
          @for (period of periods; track $index) {
          <th>{{ formatPeriod(period) }}</th>
          }
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-employee>
        <tr>
          <td>{{ employee.employee.employeeName }}</td>
          <td>{{ employee.employee.department }}</td>
          <td>{{ employee.employee.designation }}</td>
          @for (period of periods; track $index) {
          <td>
            @if (getPeriodData(employee, period); as data) {
            <div class="text-sm">
              <div>
                Net Pay:
                {{ data.totalNetPay | currency : "SAR " : "symbol" : "1.0-0" }}
              </div>
              <div>Working Days: {{ data.workingDays }}</div>
              <div>Leave Days: {{ data.leaveDays }}</div>
            </div>
            } @else {
            <div class="text-gray-400">No data</div>
            }
          </td>
          }
        </tr>
      </ng-template>
    </p-table>
  </div>
  }
</div>
